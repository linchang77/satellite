# 数据库迁移说明

## 什么是数据库迁移？

**数据库迁移（Migration）** 是 Django 用来管理数据库表结构变化的机制。

### 简单理解：
- **模型（models.py）** = 你定义的"理想"表结构（代码层面）
- **数据库表** = 实际存储在数据库中的表（数据库层面）
- **迁移** = 让两者保持一致的过程

### 两个关键命令：

1. **`python manage.py makemigrations`**
   - 作用：检查你的模型定义，生成迁移文件
   - 结果：在 `satellites/migrations/` 文件夹下生成 `.py` 文件
   - 不会修改数据库，只是记录"需要做什么改变"

2. **`python manage.py migrate`**
   - 作用：执行迁移文件，实际创建或修改数据库表
   - 结果：数据库表结构被更新

## 你的情况

根据你的 `inser_data.py` 文件，你的数据库表（`scenarios` 和 `satellites`）**已经存在**了。

### 问题：
- Django 不知道这些表已经存在
- 如果直接运行 `migrate`，Django 可能会尝试创建新表，导致冲突

### 解决方案：

#### 方案1：标记迁移为已应用（推荐）

如果你的表结构已经和模型定义一致，可以告诉 Django "这些表已经存在了，不需要创建"：

```bash
# 1. 生成迁移文件
python manage.py makemigrations

# 2. 标记初始迁移为已应用（不实际执行）
python manage.py migrate --fake-initial
```

`--fake-initial` 参数会检查表是否已存在，如果存在就标记迁移为"已完成"，不会重复创建。

#### 方案2：检查表结构是否一致

如果表结构有差异（比如缺少 `created_at`、`updated_at` 字段），需要：

1. 先检查现有表结构
2. 如果缺少字段，可以：
   - 手动在数据库中添加字段
   - 或者让 Django 自动添加（运行正常迁移）

## 操作步骤

### 第一步：生成迁移文件
```bash
python manage.py makemigrations satellites
```

这会创建迁移文件，比如 `0001_initial.py`

### 第二步：检查迁移文件
查看生成的迁移文件，确认它要创建的表和字段是否与现有表一致。

### 第三步：执行迁移

**如果表已存在且结构一致：**
```bash
python manage.py migrate --fake-initial
```

**如果表不存在或需要添加字段：**
```bash
python manage.py migrate
```

## 注意事项

⚠️ **重要**：你的模型中有 `created_at` 和 `updated_at` 字段，但现有表可能没有这些字段。

如果现有表没有这些字段，你有两个选择：

1. **让 Django 添加字段**（推荐）：
   ```bash
   python manage.py migrate
   ```
   这会自动添加缺失的字段

2. **修改模型，移除这些字段**（如果不需要）：
   修改 `satellites/models.py`，删除 `created_at` 和 `updated_at` 字段

## 验证迁移是否成功

迁移成功后，可以运行：
```bash
python manage.py showmigrations
```

这会显示所有应用的迁移状态，`[X]` 表示已应用，`[ ]` 表示未应用。

